<h2>Competition Info</h2>
<table class="table table-striped table-hover table-condensed">
  <tr>
    <th>Name</th>
    <td><%= link_to(competition.name, url_for(:competitions, :name, competition.short_name)) %></td>
  </tr>
  <tr>
    <th>Short Name</th>
    <td><%= competition.short_name %></td>
  </tr>
  <tr>
    <th>City / Country</th>
    <td><%= "#{competition.city} / #{competition.country}" %></td>
  </tr>
  <tr>
    <th>ISU Site</th>
    <td>
      <%= link_to("ISU HP", competition.site_url, target: "_blank") %>
      <span class="glyphicon glyphicon-link"></span>
    </td>
  </tr>
  <tr>
    <th>Start Date</th>
    <td><%= competition.start_date %></td>
  </tr>
  <tr>
    <th>End Date</th>
    <td><%= competition.end_date %></td>
  </tr>
</table>

<h2>Category Result</h2>

<table class="table table-striped table-hover table-condensed">
  <tr>
    <th>Category</th>
    <th>Segments</th>
    <th>1st</th>
    <th>2nd</th>
    <th>3rd</th>
  </tr>

  <% segments_for_category = Hash.new { |h,k| h[k] = [] } %>
  <% competition.scores.pluck(:category, :segment).uniq.each {|cat, seg| segments_for_category[cat] << seg} %>

  <% ranks = Hash.new { |h,k| h[k] = {} } %>
  <% competition.category_results.where("rank >= 1 and rank <= 3").each {|res| ranks[res.category][res.rank] = res.skater} %>

  <% competition.category_results.pluck(:category).uniq.each do |category| %>
  <tr>
    <td><%= link_to(category, url_for(:competitions, :id, id: competition.id, category: category)) %></td>
    <% size = segments_for_category.size %>
    <td><% segments_for_category[category].each_with_index do |segment, i| %>
      <%= link_to(segment, url_for(:competitions, :id, id: competition.id, category: category, segment: segment)) %>, 
      <% end %>
	  
    <% 1.upto(3) do |i|  %>
    <td><%= link_to_skater(ranks[category][i]) %></td>
    <% end %>
  </tr>
  <% end %>

</table>

